<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cinaldo Imóveis – Linhares/ES</title>
  <meta name="description" content="Imóveis selecionados em Linhares – ES. Negócios com transparência e segurança." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Cinaldo Imóveis – Linhares/ES" />
  <meta property="og:description" content="Imóveis selecionados em Linhares – ES. Negócios com transparência e segurança." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://cinaldoimoveis.com.br/" />
  <meta property="og:image" content="https://cinaldoimoveis.com.br/assets/og-cinaldo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Cinaldo Imóveis – Linhares/ES" />
  <meta name="twitter:description" content="Imóveis selecionados em Linhares – ES. Negócios com transparência e segurança." />
  <meta name="twitter:image" content="https://cinaldoimoveis.com.br/assets/og-cinaldo.png" />

  <!-- ===== CSS BASE ===== -->
  <style>
    :root{
      --bg:#f8f3ec; --fg:#111; --muted:#555; --accent:#c7a24b; --card:#f3eee8; --line:#eaeaea;
      --side: 20px;
      --glow: 0 0 0 3px rgba(199,162,75,.45);
    }
    .container{
      max-width:1150px; margin:0 auto;
      padding-left:max(var(--side), env(safe-area-inset-left));
      padding-right:max(var(--side), env(safe-area-inset-right));
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.92);backdrop-filter:saturate(150%) blur(8px);border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0;gap:12px}
    .brand{display:flex;align-items:center;gap:-2px;font-weight:800;letter-spacing:.2px;white-space:nowrap}
    .brand-logo-img{width:44px;height:44px;object-fit:contain;border-radius:10px}
    .brand small{display:block;font-weight:600;font-size:12px;color:var(--muted);letter-spacing:.4px;margin-left:2px}
    .menu{display:flex;gap:18px;align-items:center}

    .btn{display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid var(--fg);transition:.2s;font-weight:600}
    .btn:hover{transform:translateY(-1px)}
    .btn-whats{background:#25D366;border-color:#25D366;color:#0b3c1b}

    @media (max-width:640px){
      .nav{flex-wrap:wrap}
      .brand-logo-img{width:36px;height:36px}
      .menu{width:100%;justify-content:flex-end;gap:12px;padding:0}
      .btn{padding:10px 14px;border-radius:10px}
      .btn-whats{font-size:14px;line-height:1}
    }
    @media (orientation: landscape) and (max-width: 900px){
      .menu{gap:12px;padding:0}
      .btn{padding:10px 14px;border-radius:10px}
      .btn-whats{font-size:14px;line-height:1}
    }

    .hero{padding:64px 0 32px;border-bottom:1px solid var(--line)}
    .hero-inner{display:grid;grid-template-columns:1.2fr .8fr;gap:26px;align-items:center}
    @media (max-width:900px){.hero-inner{grid-template-columns:1fr}}
    .title{font-size:clamp(28px,4vw,40px);line-height:1.1;margin:0 0 8px}
    .subtitle{color:var(--muted);font-size:clamp(14px,2.2vw,16px);margin:0 0 20px}
    .call{display:flex;gap:12px;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--line);padding:8px 12px;border-radius:999px;font-size:13px;color:var(--muted)}
    section{padding:28px 0}
    footer{border-top:1px solid var(--line);padding:28px 0;color:#666}
    .accent{color:var(--accent)}

    /* GRID + CARDS */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{background:#ffffff;border:1px solid var(--line);border-radius:18px;overflow:hidden;box-shadow:0 1px 0 rgba(0,0,0,.04),0 6px 24px rgba(0,0,0,.04);transition:transform .25s, box-shadow .25s;}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,0.08)}
    .card.glow{box-shadow:var(--glow),0 6px 24px rgba(0,0,0,.08)}
    .thumb{aspect-ratio:16/9;background:#f1f1f1;display:grid;place-items:center;color:#333}
    .thumb-img{width:100%;height:100%;object-fit:cover}
    .content{padding:16px}
    .price{font-weight:800;font-size:18px;margin:10px 0}
    .ul{margin:8px 0 0;padding:0 0 0 18px;color:#333}
    .pill{display:inline-block;background:#f6f1ea;border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:12px;color:#444}
  </style>

  <!-- ===== Filtros ===== -->
  <style>
    .filters{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0 18px}
    .filters .fbtn{padding:8px 12px;border:1px solid var(--line);background:#fff;border-radius:999px;font-weight:600;font-size:14px;cursor:pointer;transition:.18s;box-shadow:0 1px 0 rgba(0,0,0,.04)}
    .filters .fbtn:hover{transform:translateY(-1px)}
    .filters .fbtn.is-active{background:#111;color:#fff;border-color:#111}
    .grid.filtering .card{transition:opacity .18s, transform .18s}
    .card[hidden]{display:none!important}
  </style>

  <!-- Botão "Ver fotos" + Modal -->
  <style>
    .btn-fotos{display:inline-block;padding:.75rem 1rem;border:0;border-radius:.5rem;background:#111;color:#fff;cursor:pointer;font-weight:600;transition:all .25s}
    .btn-fotos:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,.25);background:#000}
    .gallery-modal{position:fixed;inset:0;display:none;z-index:1000}
    .gallery-modal.open{display:block}
    .gallery-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.6)}
    .gallery-content{position:relative;margin:4vh auto 0;max-width:1100px;background:#fff;border-radius:.75rem;padding:1rem;max-height:92vh;overflow:auto}
    .gallery-close{position:sticky;top:0;margin-left:auto;border:0;background:transparent;font-size:2rem;line-height:1;cursor:pointer}
    .gallery-grid{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .gallery-grid a{display:block;border-radius:.5rem;overflow:hidden;border:1px solid #eee}
    .gallery-grid img{width:100%;height:200px;object-fit:cover;display:block}
  </style>

  <!-- Destaques + logo -->
  <style>
    .mini-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:8px}
    .mini-item{display:flex;align-items:center;justify-content:center;border:1px solid var(--line);background:#fff;border-radius:12px;padding:8px}
    .mini-item img{width:100%;height:auto;aspect-ratio:4/3;object-fit:cover;border-radius:8px}
    @media (orientation: portrait){.mini-list{grid-template-columns:1fr 1fr;gap:12px}}
    @media (orientation: landscape){.mini-list{grid-template-columns:repeat(3,1fr);gap:10px}.mini-item img{aspect-ratio:16/9}}
    @media (max-width:360px){.mini-list{grid-template-columns:1fr 1fr}}
    @media (min-width: 1024px){
      .mini-list{grid-template-columns:repeat(3,1fr);gap:10px}
      .mini-item{border:.5px solid rgba(0,0,0,.10);box-shadow:0 1px 0 rgba(0,0,0,.03);padding:6px;border-radius:10px;background:#fff}
      .mini-item img{aspect-ratio:16/9;border-radius:8px}
    }
  </style>

  <!-- Viewer (zoom) -->
  <style>
    .viewer[hidden]{display:none}
    .viewer{position:fixed;inset:0;z-index:2000;background:#000}
    .viewer .toolbar{position:absolute;top:0;left:0;right:0;height:56px;display:flex;align-items:center;justify-content:center;gap:12px;background:rgba(0,0,0,.5)}
    .viewer .btn-close{position:absolute;right:10px;background:transparent;border:0;color:#fff;font-size:28px;line-height:1;cursor:pointer}
    .viewer .btn-open{position:absolute;left:10px;background:rgba(255,255,255,.85);border:0;border-radius:10px;padding:6px 10px;cursor:pointer;font-weight:600}
    .viewer .viewport{position:absolute;inset:0;top:56px;overflow:hidden;touch-action:none}
    .viewer .stage{position:absolute;inset:0;display:grid;place-items:center;transition:transform .12s ease-out}
    .viewer .pic{max-width:100vw;max-height:calc(100vh - 56px);object-fit:contain;display:block;will-change:transform}
    .viewer .arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.35);border:0;color:#fff;font-size:28px;padding:10px 14px;border-radius:10px;cursor:pointer}
    .viewer .left{left:12px}
    .viewer .right{right:12px}
    .viewer .count{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);opacity:.8;font-weight:700}
    @media (hover:hover){ .viewer .stage{cursor:grab} .viewer .stage:active{cursor:grabbing} }
  </style>

  <!-- Leaflet CSS (mapas) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <!-- Mapa (modal) -->
  <style>
    .map-modal[hidden]{display:none}
    .map-modal{position:fixed;inset:0;z-index:2500;display:grid;place-items:center;background:rgba(0,0,0,.55)}
    .map-card{width:min(900px, 92vw);height:min(640px, 85vh);background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 18px 60px rgba(0,0,0,.25);display:grid;grid-template-rows:48px 1fr}
    .map-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:#f7f7f7;border-bottom:1px solid #e8e8e8}
    .map-title{font-weight:700}
    .map-close{background:transparent;border:0;font-size:24px;cursor:pointer;line-height:1}
    #map{width:100%;height:100%;min-height:320px}
    .btn-map{display:block;width:100%;text-align:center;margin:0 0 6px 0;padding:.3rem .6rem;border:1px solid #ddd;border-radius:6px;background:#fafafa;cursor:pointer;font-weight:500;font-size:.8rem;color:#555;transition:.25s}
    .btn-map:hover{background:#f2f2f2;color:#222;transform:translateY(-1px);box-shadow:0 1px 4px rgba(0,0,0,.05)}
  </style>
</head>
<body>
  <!-- ===== Modal do MAPA (AGORA ANTES dos scripts) ===== -->
  <div id="map-modal" class="map-modal" hidden aria-hidden="true" role="dialog" aria-label="Localização aproximada">
    <div class="map-card">
      <div class="map-head">
        <div class="map-title">Localização aproximada</div>
        <button class="map-close" title="Fechar" aria-label="Fechar">&times;</button>
      </div>
      <div id="map"></div>
    </div>
  </div>

  <header>
    <div class="container nav">
      <a href="#inicio" class="brand">
        <img class="brand-logo-img" src="assets/logo-bimi.svg" alt="Cinaldo Imóveis">
        <div>Cinaldo Imóveis<small> Linhares – ES</small></div>
      </a>
      <nav class="menu">
        <a href="#imoveis">Imóveis</a>
        <a href="#sobre">Sobre</a>
        <a href="#contato">Contato</a>
        <a class="btn btn-whats" href="https://wa.me/5527999567000?text=Ol%C3%A1%2C%20quero%20falar%20sobre%20im%C3%B3veis%20em%20Linhares.%0AMeu%20nome%20%C3%A9%20_____%20e%20tenho%20interesse%20em%3A" target="_blank" rel="noopener">💬 WhatsApp</a>
      </nav>
    </div>
  </header>

  <main id="inicio" class="hero">
    <div class="container hero-inner">
      <div>
        <div class="badge">🏡 Imóveis selecionados • Negócios com transparência</div>
        <h1 class="title">Seu novo imóvel em <span class="accent">Linhares ES e Região</span></h1>
        <p class="subtitle">Atendimento direto com o corretor. Segurança, clareza e as melhores oportunidades da região.</p>
        <div class="call">
          <a class="btn btn-whats" href="https://wa.me/5527999567000?text=Ol%C3%A1%2C%20quero%20falar%20sobre%20im%C3%B3veis%20em%20Linhares.%0AMeu%20nome%20%C3%A9%20_____%20e%20tenho%20interesse%20em%3A" target="_blank" rel="noopener">Fale agora no WhatsApp</a>
          <a class="btn" href="#imoveis">Ver imóveis em destaque</a>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="thumb"><img class="thumb-img" src="assets/logo-bimi.svg" alt="Cinaldo Imóveis"></div>
          <div class="content">
            <strong>Destaques de hoje</strong>
            <div class="mini-list" id="mini-highlights" aria-label="Destaques de hoje"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <section id="imoveis">
    <div class="container">
      <h2 class="title" style="font-size:28px">Imóveis em destaque</h2>

      <div class="filters" id="filters">
        <button class="fbtn is-active" data-filter="all">Todos</button>
        <button class="fbtn" data-filter="casa">Casas</button>
        <button class="fbtn" data-filter="apartamento">Apartamentos</button>
        <button class="fbtn" data-filter="lote">Lotes</button>
        <button class="fbtn" data-filter="area">Áreas</button>
        <button class="fbtn" data-filter="fazenda">Fazendas</button>
        <button class="fbtn" data-filter="comercial">Comercial</button>
      </div>

      <div class="grid">
        <!-- (seus cards exatamente como estavam) -->
        <!-- Casa em Alphaville -->
        <article class="card" id="casa-alphaville"
          data-code="CI-CA-ALPH-217" data-type="casa" data-tags="casa" data-geo="alphaville-casa-217">
          <div class="thumb"><img src="assets/alphaville-casa-01.jpeg" alt="Casa em Alphaville, Linhares/ES" loading="lazy"></div>
          <div class="content">
            <h3>Casa 3Q (2 Suítes) – Alphaville</h3>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <span class="pill">217m² const.</span><span class="pill">Lote 420m²</span><span class="pill">3Q • 2 suítes</span><span class="pill">2 vagas</span><span class="pill">Sol da manhã</span>
              <span class="pill">Ref: CI-CA-ALPH-217</span>
            </div>
            <p class="price">R$ 1.900.000,00</p>
            <ul class="ul"><li>Área gourmet integrada</li><li>Quintal com espaço para piscina</li></ul>
            <p>
              <button class="btn-fotos" data-gallery-prefix="alphaville-casa-" data-gallery-count="16">Ver fotos</button>
              <a class="btn btn-whats js-wa" href="#" target="_blank" rel="noopener">Agendar visita</a>
            </p>
          </div>
        </article>

        <!-- (demais cards inalterados; mantive todos os seus dados) -->
        <!-- ... TODA a sua lista de artigos daqui em diante permanece igual ao que enviou ... -->
        <!-- Para economizar espaço na mensagem, mantive os mesmos elementos que você colou (Laguna, Lotes, Fazenda, Apto, Unique, Área Planalto, 717m², Complexo SM, Casa em construção, Lote 253m², Lote 390m²). -->
        <!-- >>> Copie os seus <article> exatamente como estavam que funcionará com os scripts abaixo. <<< -->
        <!-- (FIM da grade) -->
      </div>
    </div>
  </section>

  <section id="sobre"><div class="container"><h2 class="title">Sobre</h2><p>Sou o <strong>Cinaldo O Ferreira</strong>, corretor de imóveis em Linhares – ES. Trabalho com foco total em segurança, clareza e atendimento direto.</p></div></section>
  <section id="contato"><div class="container"><h2 class="title">Contato</h2><p>📲 <strong>WhatsApp:</strong> <a href="https://wa.me/5527999567000" target="_blank" rel="noopener">(27) 99956-7000</a></p><p>✉️ <strong>E-mail:</strong> <a href="mailto:cinaldo@cinaldoimoveis.com.br">cinaldo@cinaldoimoveis.com.br</a></p></div></section>

  <footer><div class="container" style="display:flex;justify-content:space-between;flex-wrap:wrap"><div>© <span id="y"></span> Cinaldo Imóveis • Linhares – ES</div><div style="color:#777">CRECI 8356-F</div></div></footer>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>

  <!-- Modal da galeria -->
  <div id="gallery-modal" class="gallery-modal" aria-hidden="true">
    <div class="gallery-backdrop" data-close></div>
    <div class="gallery-content" role="dialog" aria-modal="true" aria-label="Galeria de fotos">
      <button class="gallery-close" title="Fechar" data-close>&times;</button>
      <div id="gallery-grid" class="gallery-grid"></div>
    </div>
  </div>

  <!-- VISOR -->
  <div class="viewer" id="viewer" hidden>
    <div class="toolbar">
      <button class="btn-open" id="openNew" title="Abrir esta imagem em nova aba">↗ abrir em nova aba</button>
      <span class="count"><b id="vi">1</b>/<span id="vt">1</span></span>
      <button class="btn-close" title="Fechar" aria-label="Fechar">&times;</button>
    </div>
    <div class="viewport" id="vp"><div class="stage" id="stg"><img id="ph" class="pic" alt=""></div></div>
    <button class="arrow left" aria-label="Anterior">&#8592;</button>
    <button class="arrow right" aria-label="Próxima">&#8594;</button>
  </div>

  <!-- WhatsApp automático por card -->
  <script>
  (function(){
    const WHATS_BASE = 'https://wa.me/5527999567000?text=';
    document.querySelectorAll('article.card[data-code]').forEach(card => {
      const code  = card.getAttribute('data-code') || '';
      const title = (card.querySelector('h3')?.textContent || '').trim();
      const price = (card.querySelector('.price')?.textContent || '').trim();
      const a     = card.querySelector('a.btn.btn-whats.js-wa');
      if(!a) return;
      const msg = `Olá, tenho interesse em ${title} (${price}).\nRef: ${code}`;
      a.href = WHATS_BASE + encodeURIComponent(msg);
    });
  })();
  </script>

  <!-- Destaques do dia -->
  <script>
  (function(){
    const box = document.getElementById('mini-highlights');
    if (!box) return;
    const cards = Array.from(document.querySelectorAll('#imoveis article.card'));
    const items = cards.map(card => {
      const id  = card.id || '';
      const img = card.querySelector('.thumb img');
      const h3  = card.querySelector('h3');
      if (!img) return null;
      return { href: id ? `#${id}` : '#', id, src: img.getAttribute('src') || img.src || '', alt: h3 ? h3.textContent.trim() : 'Imóvel' };
    }).filter(Boolean);
    if (!items.length) return;
    const dayNumber = Math.floor(new Date().setHours(0,0,0,0) / 86400000);
    const rotate = (arr, n) => arr.map((_, i) => arr[(i + n) % arr.length]);
    const rotated = rotate(items, dayNumber % items.length);
    const picks = rotated.slice(0, Math.min(3, rotated.length));
    box.innerHTML = picks.map(it => `<a class="mini-item" href="${it.href}" data-target="${it.id}"><img src="${it.src}" alt="${it.alt}" loading="lazy"></a>`).join('');

    // >>> Novo: clicar no destaque remove filtro e revela o card mesmo com filtro ativo
    function clearFilterAndReveal(targetId){
      const bar = document.getElementById('filters');
      const btnAll = bar?.querySelector('.fbtn[data-filter="all"]');
      if (btnAll) {
        bar.querySelectorAll('.fbtn').forEach(b=>b.classList.remove('is-active'));
        btnAll.classList.add('is-active');
      }
      // revelar todos
      document.querySelectorAll('#imoveis .grid .card').forEach(card=>card.hidden=false);

      const el = document.getElementById(targetId);
      if (!el) return;
      el.classList.add('glow');
      el.scrollIntoView({behavior:'smooth', block:'center'});
      setTimeout(()=> el.classList.remove('glow'), 1200);
    }

    box.addEventListener('click', (e)=>{
      const a = e.target.closest('a.mini-item');
      if(!a) return;
      e.preventDefault();
      const target = a.getAttribute('data-target');
      if (target) clearFilterAndReveal(target);
    });
  })();
  </script>

  <!-- Filtros -->
  <script>
  (function(){
    const bar   = document.getElementById('filters');
    const grid  = document.querySelector('#imoveis .grid');
    const cards = Array.from(grid.querySelectorAll('.card'));
    if(!bar || !grid) return;

    function getTags(card){
      const raw = card.getAttribute('data-tags');
      if(raw && raw.trim()) return raw.split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
      const t = (card.getAttribute('data-type')||'').toLowerCase().trim();
      return t ? [t] : [];
    }

    function applyFilter(type){
      grid.classList.add('filtering');
      const f = (type||'all').toLowerCase();
      cards.forEach(card=>{
        const tags = getTags(card);
        const show = (f==='all') || tags.includes(f);
        card.hidden = !show;
      });
      grid.classList.remove('filtering');
    }

    bar.addEventListener('click', (e)=>{
      const btn = e.target.closest('.fbtn'); if(!btn) return;
      bar.querySelectorAll('.fbtn').forEach(b=>b.classList.remove('is-active'));
      btn.classList.add('is-active');
      applyFilter(btn.dataset.filter);
      const hash = btn.dataset.filter === 'all' ? '' : '#tipo=' + btn.dataset.filter;
      history.replaceState(null, '', location.pathname + location.search + hash);
    });

    const m = location.hash.match(/tipo=([\w-]+)/i);
    const startType = m ? m[1].toLowerCase() : 'all';
    const startBtn = bar.querySelector(`.fbtn[data-filter="${startType}"]`) || bar.querySelector('.fbtn[data-filter="all"]');
    startBtn.classList.add('is-active');
    applyFilter(startType);
  })();
  </script>

  <!-- Galeria + visor (agora com pinch e double-tap no mobile) -->
  <script>
  (function(){
    const modal = document.getElementById('gallery-modal');
    const grid  = document.getElementById('gallery-grid');
    const viewer = document.getElementById('viewer');
    const ph = document.getElementById('ph');
    const stg = document.getElementById('stg');
    const vp  = document.getElementById('vp');
    const vi  = document.getElementById('vi');
    const vt  = document.getElementById('vt');
    const openNew = document.getElementById('openNew');

    let imgs = [];
    let idx=0, scale=1, minScale=1, maxScale=4, tx=0, ty=0;
    let isDraggingMouse=false, dragSX=0, dragSY=0;

    function setT(){ stg.style.transform = 'translate3d('+tx+'px,'+ty+'px,0) scale('+scale+')'; }
    function reset(){ scale=1; tx=0; ty=0; setT(); }
    function show(i){
      idx=(i+imgs.length)%imgs.length;
      const src=imgs[idx];
      ph.src=src; ph.alt='Foto '+(idx+1);
      vi.textContent=(idx+1);
      openNew.onclick=()=>window.open(src,'_blank','noopener');
      reset();
    }
    function openViewer(startIndex){ idx=startIndex; vt.textContent = imgs.length; show(idx); viewer.hidden=false; document.documentElement.style.overflow='hidden'; }
    function closeViewer(){ viewer.hidden=true; document.documentElement.style.overflow=''; }

    document.querySelector('.viewer .left').addEventListener('click', ()=>show(idx-1));
    document.querySelector('.viewer .right').addEventListener('click', ()=>show(idx+1));
    document.querySelector('.viewer .btn-close').addEventListener('click', closeViewer);
    window.addEventListener('keydown', e=>{ if(viewer.hidden) return; if(e.key==='ArrowLeft')show(idx-1); if(e.key==='ArrowRight')show(idx+1); if(e.key==='Escape')closeViewer(); });

    // Swipe simples (sem zoom)
    let swipeSX=0, swipeSY=0, swipeTime=0;
    vp.addEventListener('touchstart', e=>{ if(e.touches.length===1){ swipeSX=e.touches[0].clientX; swipeSY=e.touches[0].clientY; swipeTime=Date.now(); } }, {passive:true});
    vp.addEventListener('touchend', e=>{
      if(!e.changedTouches.length) return;
      const dx=e.changedTouches[0].clientX - swipeSX;
      const dy=e.changedTouches[0].clientY - swipeSY;
      const dt=Date.now()-swipeTime;
      if(Math.abs(dx)>60 && Math.abs(dx)>Math.abs(dy) && scale<=1.05){ if(dx<0) show(idx+1); else show(idx-1); return; }
      if(scale<=1.02 && dy>120 && dt<500){ closeViewer(); }
    }, {passive:true});

    // Zoom com roda (desktop)
    vp.addEventListener('wheel', e=>{
      e.preventDefault();
      const delta = -e.deltaY;
      const zoom = delta>0 ? 1.1 : 0.9;
      const newScale = Math.min(maxScale, Math.max(minScale, scale * zoom));
      if(newScale !== scale){ scale = newScale; setT(); }
    }, {passive:false});

    // Pan com mouse
    stg.addEventListener('mousedown', e=>{
      if(e.button!==0) return;
      isDraggingMouse = true;
      dragSX = e.clientX - tx;
      dragSY = e.clientY - ty;
      stg.style.cursor = 'grabbing';
    });
    window.addEventListener('mousemove', e=>{
      if(!isDraggingMouse || scale<=1) return;
      tx = e.clientX - dragSX; ty = e.clientY - dragSY; setT();
    });
    window.addEventListener('mouseup', ()=>{ isDraggingMouse = false; stg.style.cursor = 'grab'; });

    // Double-click (desktop)
    vp.addEventListener('dblclick', ()=>{ if(scale===1){ scale=2; } else { scale=1; tx=0; ty=0; } setT(); });

    // === NOVO: double-tap (mobile) ===
    let lastTapTime=0;
    vp.addEventListener('touchstart', (e)=>{
      if(e.touches.length===1){
        const now=Date.now();
        if(now-lastTapTime<300){
          // double-tap
          if(scale===1){ scale=2; } else { scale=1; tx=0; ty=0; }
          setT();
        }
        lastTapTime=now;
      }
    }, {passive:true});

    // === NOVO: pinch-to-zoom (mobile) ===
    let pinchStartDist=0, pinchStartScale=1;
    let pinchStartMidX=0, pinchStartMidY=0;
    vp.addEventListener('touchstart', (e)=>{
      if(e.touches.length===2){
        const dx=e.touches[0].clientX - e.touches[1].clientX;
        const dy=e.touches[0].clientY - e.touches[1].clientY;
        pinchStartDist=Math.hypot(dx,dy);
        pinchStartScale=scale;
        pinchStartMidX=(e.touches[0].clientX + e.touches[1].clientX)/2;
        pinchStartMidY=(e.touches[0].clientY + e.touches[1].clientY)/2;
      }
    }, {passive:true});
    vp.addEventListener('touchmove', (e)=>{
      if(e.touches.length===2){
        e.preventDefault();
        const dx=e.touches[0].clientX - e.touches[1].clientX;
        const dy=e.touches[0].clientY - e.touches[1].clientY;
        const dist=Math.hypot(dx,dy);
        const factor=dist/pinchStartDist;
        scale=Math.min(maxScale, Math.max(minScale, pinchStartScale*factor));
        setT();
      }
    }, {passive:false});

    function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; grid.innerHTML=''; }

    modal.addEventListener('click',(e)=>{ if(e.target.hasAttribute('data-close')) closeModal(); });
    document.addEventListener('keydown',(e)=>{ if(e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

    // CLICK em "Ver fotos"
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.btn-fotos'); if(!btn) return;
      const prefix     = btn.dataset.galleryPrefix;
      const count      = parseInt(btn.dataset.galleryCount || '0', 10);
      const extDefault = btn.dataset.galleryExt || '.jpeg';
      const extFirst   = btn.dataset.galleryExtFirst || extDefault;
      imgs = []; grid.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        const nn=String(i).padStart(2,'0');
        const extUse=(i===1?extFirst:extDefault);
        const src=`assets/${prefix}${nn}${extUse}`;
        const k=i-1;
        imgs.push(src);
        const a=document.createElement('a'); a.href=src; a.target='_blank'; a.rel='noopener';
        const img=document.createElement('img'); img.loading='lazy'; img.alt=`Foto ${i}`; img.src=src;
        a.addEventListener('click',(ev)=>{ ev.preventDefault(); openViewer(k); });
        a.appendChild(img); grid.appendChild(a);
      }
      openModal();
    });
  })();
  </script>

  <!-- Esconde o botão "Abrir em nova aba" onde não faz sentido -->
  <style id="hide-open-desktop">@media (any-pointer: fine){#openNew{display:none!important;visibility:hidden!important;opacity:0!important}}</style>
  <style id="hide-open-mobile">@media (any-pointer: coarse){#openNew{display:none!important;visibility:hidden!important;opacity:0!important}}</style>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Script do mapa (com linha de segurança) -->
  <script>
(function(){
  // --- COORDENADAS ---
  const GEO = {
    alphaville: [-19.392604, -40.025909],
    'alphaville-casa-217': [-19.397728, -40.022248],
    'alphaville-lote-360': [-19.392500, -40.024900],
    'alphaville-lote-420': [-19.397728, -40.022248],
    'alphaville-lote-717': [-19.391800, -40.025300],
    'alphaville-lote-390': [-19.397728, -40.022248],
    'alphaville-casa-186': [-19.397728, -40.022248],
    'alphaville-lote-437c': [-19.391600, -40.026000],
    unique: [-19.327982, -40.075060],
    'complexo-sao-mateus': [-18.731801, -39.790920],
    'casa-simples-laguna': [-19.376735, -40.053552],
    laguna: [-19.374194, -40.055102],
    'apto-tres-barras': [-19.378666, -40.069564],
    'fazenda-linhares': [-19.257191, -39.801592],
    'area-planalto-20000': [-19.341756, -40.057675],
  };

  // --- elementos do modal ---
  const modal  = document.getElementById('map-modal');
  const btnX   = modal ? modal.querySelector('.map-close') : null;
  const mapDiv = document.getElementById('map');

  let map, circle;

  // injeta o botão em cada card (uma vez)
  document.querySelectorAll('article.card[data-geo]').forEach(card=>{
    if(card.querySelector('.btn-map')) return;
    const p = card.querySelector('p');
    if(!p) return;
    const b = document.createElement('button');
    b.className = 'btn-map';
    b.type = 'button';
    b.textContent = '📍 Ver localização aproximada';
    b.dataset.geo = card.getAttribute('data-geo') || '';
    p.prepend(b);
  });

  // delegação: um único listener para todos os botões
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.btn-map');
    if(!btn) return;
    e.preventDefault();
    const key = btn.dataset.geo;
    openMap(key);
  });

  function ensureMap(){
    if(map) return map;
    if(typeof L === 'undefined'){
      console.error('Leaflet (L) não carregado.');
      return null;
    }
    map = L.map(mapDiv, { zoomControl:true, attributionControl:true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);
    return map;
  }

  function renderCircleAndZoom(coords){
    if(!map) return;
    const isMobile = window.matchMedia('(max-width: 640px)').matches;
    const MAX_ZOOM = isMobile ? 14 : 15;

    if(circle){ circle.remove(); }
    circle = L.circle(coords, {
      radius: 500, color:'#2b7', fillColor:'#2b7', fillOpacity:0.12, weight:2
    }).addTo(map);

    map.fitBounds(circle.getBounds(), { padding:[24,24], maxZoom:MAX_ZOOM, animate:false });
    map.invalidateSize();
    setTimeout(()=> map.invalidateSize(), 60);
  }

  function openMap(key){
    try{
      const coords = GEO[key];
      if(!coords){
        alert('Localização indisponível.');
        return;
      }
      if (!modal) return; // segurança extra
      // 1) abre o modal agora
      modal.hidden = false;
      modal.setAttribute('aria-hidden','false');
      document.documentElement.style.overflow = 'hidden';

      // 2) prepara/atualiza o mapa
      requestAnimationFrame(()=>{
        const ok = ensureMap();
        if(!ok) return;
        setTimeout(()=>{ renderCircleAndZoom(coords); }, 0);
      });
    }catch(err){
      console.error('Erro ao abrir mapa:', err);
    }
  }

  function closeMap(){
    if (!modal) return;
    modal.hidden = true;
    modal.setAttribute('aria-hidden','true');
    document.documentElement.style.overflow = '';
  }

  if(btnX) btnX.addEventListener('click', closeMap);
  if (modal) modal.addEventListener('click', (e)=>{ if(e.target === modal) closeMap(); }); // << linha de segurança
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal && modal.getAttribute('aria-hidden') === 'false') closeMap(); });

  // expõe se quiser usar em outros pontos
  window.openMap = openMap;
  window.closeMap = closeMap;
})();
  </script>
</body>
</html>
